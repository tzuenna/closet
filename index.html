<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mon Soin V6 | Compact</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- 基礎設定 --- */
        :root {
            --bg: #FDFBF7;
            --text: #333;
            --gold: #C5A059;
            --gray: #999;
            --serif: 'Playfair Display', serif;
            --sans: 'Lato', sans-serif;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: var(--sans);
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 20px 12px;
        }

        /* --- Header --- */
        header { text-align: center; margin-bottom: 20px; }
        h1 { font-family: var(--serif); font-size: 2rem; margin: 0; color: #222; }
        .sub { font-size: 10px; color: var(--gold); letter-spacing: 2px; text-transform: uppercase; }

        /* --- Filter Bar --- */
        .filter-scroll {
            display: flex; gap: 15px; overflow-x: auto; padding-bottom: 8px; margin-bottom: 15px;
            border-bottom: 1px solid #EAE5E0; -ms-overflow-style: none; scrollbar-width: none;
        }
        .filter-scroll::-webkit-scrollbar { display: none; }
        .filter-item {
            font-size: 13px; color: #aaa; cursor: pointer; white-space: nowrap; transition: 0.2s;
        }
        .filter-item.active { color: #222; font-weight: 700; border-bottom: 2px solid var(--gold); }

        /* --- 列表區 (Compact List) --- */
        .list-container { display: flex; flex-direction: column; gap: 10px; }

        .item-row {
            background: #fff;
            padding: 12px 15px; /* 縮小內距 */
            border: 1px solid #eee;
            border-radius: 4px; /*稍微圓角*/
            display: flex;
            align-items: center; /* 垂直置中 */
            justify-content: space-between;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }

        /* 左側：資訊區 */
        .info-col {
            flex: 1; /* 佔滿剩餘空間 */
            padding-right: 10px;
        }

        /* 第一行：名稱 + 品牌 */
        .row-header {
            display: flex; align-items: baseline; gap: 8px; margin-bottom: 4px;
        }
        .i-name {
            font-family: var(--serif); font-size: 16px; font-weight: 600; color: #222;
            line-height: 1.2;
        }
        .i-brand { font-size: 11px; color: #888; text-transform: uppercase; }
        .i-cat { font-size: 10px; color: var(--gold); border: 1px solid var(--gold); padding: 0 4px; border-radius: 4px; margin-left: 5px; }

        /* 第二行：並排資訊 (數量 | 價格 | 日期) */
        .row-meta {
            font-size: 12px; color: #666;
            display: flex; align-items: center; gap: 10px;
        }
        .meta-tag { display: flex; align-items: center; gap: 3px; }
        .meta-tag b { font-weight: 400; color: #aaa; font-size: 10px; } /* 標籤文字 */

        /* 右側：動作區 (狀態按鈕) */
        .action-col {
            display: flex; flex-direction: column; align-items: flex-end; gap: 5px;
            min-width: 70px; /* 固定寬度確保按鈕整齊 */
        }

        /* 狀態按鈕樣式 */
        .btn-status {
            font-size: 11px; padding: 4px 8px; border: 1px solid #ddd;
            background: transparent; border-radius: 20px; cursor: pointer; text-align: center;
            width: 100%;
        }
        .st-new { border-color: var(--gold); color: var(--gold); }
        .st-new:hover { background: var(--gold); color: #fff; }
        .st-used { background: #f5f5f5; border-color: transparent; color: #999; cursor: default; }

        /* 刪除小按鈕 */
        .btn-del {
            font-size: 16px; color: #eee; background: none; border: none; 
            padding: 0; margin-top: 2px; cursor: pointer;
        }
        .btn-del:hover { color: #d00; }

        /* --- FAB Button --- */
        .fab {
            position: fixed; bottom: 25px; right: 20px;
            width: 48px; height: 48px; border-radius: 50%;
            background: #222; color: #fff; border: none; font-size: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); cursor: pointer; z-index: 100;
        }

        /* --- Modal --- */
        #modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 999; justify-content: center; align-items: center; padding: 20px;
        }
        .modal-box {
            background: #fff; width: 100%; max-width: 400px; padding: 25px;
            max-height: 90vh; overflow-y: auto; border-radius: 4px;
        }
        .inp-row { margin-bottom: 12px; }
        label { display: block; font-size: 11px; color: #999; margin-bottom: 4px; }
        input, select { width: 100%; padding: 8px; border: 1px solid #eee; border-radius: 4px; font-size: 14px; }
        .save-btn { width: 100%; padding: 12px; background: #222; color: #fff; border: none; margin-top: 10px; cursor: pointer; }
        .close { float: right; border: none; background: none; font-size: 20px; color: #ccc; cursor: pointer; }

    </style>
</head>
<body>

    <header>
        <h1>Mon Soin</h1>
        <div class="sub">V6 Compact List</div>
    </header>

    <div class="filter-scroll" id="filterBar"></div>

    <div id="list" class="list-container"></div>
    
    <div id="empty" style="text-align:center; color:#ccc; margin-top:50px; font-size:12px;">無庫存資料</div>

    <button class="fab" onclick="openModal()">＋</button>

    <div id="modal">
        <div class="modal-box">
            <button class="close" onclick="closeModal()">×</button>
            <h3 style="margin:0 0 20px 0; font-family:var(--serif);">Add Item</h3>
            
            <div class="inp-row">
                <label>Category</label>
                <select id="m_cat" onchange="checkCat(this)">
                    <option value="精華液">精華液</option>
                    <option value="乳霜">乳霜</option>
                    <option value="化妝水">化妝水</option>
                    <option value="防曬">防曬</option>
                    <option value="洗面乳">洗面乳</option>
                    <option value="面膜">面膜</option>
                    <option value="ADD">+ 新增...</option>
                </select>
            </div>
            <div class="inp-row"><label>Brand</label><input type="text" id="m_brand" placeholder="Brand"></div>
            <div class="inp-row"><label>Name</label><input type="text" id="m_name" placeholder="Product Name"></div>
            <div style="display:flex; gap:10px;">
                <div class="inp-row" style="flex:1"><label>Qty</label><input type="number" id="m_qty" value="1"></div>
                <div class="inp-row" style="flex:1"><label>Price</label><input type="number" id="m_price" placeholder="$"></div>
            </div>
            <div class="inp-row"><label>Date</label><input type="date" id="m_date"></div>
            <div class="inp-row">
                <label>Status</label>
                <select id="m_status">
                    <option value="new">未開封 (New)</option>
                    <option value="used">使用中 (Used)</option>
                </select>
            </div>
            <button class="save-btn" onclick="saveData()">SAVE</button>
        </div>
    </div>

<script>
    const DB_KEY = 'mon_soin_v6';
    let data = [];
    let curFilter = 'All';

    window.onload = function() {
        const stored = localStorage.getItem(DB_KEY);
        if(stored) data = JSON.parse(stored);
        renderFilter();
        render();
    }

    // --- Render Logic ---
    function renderFilter() {
        const bar = document.getElementById('filterBar');
        bar.innerHTML = '';
        const cats = ['All', ...new Set(data.map(i => i.cat))];
        
        cats.forEach(c => {
            const span = document.createElement('span');
            span.className = `filter-item ${c === curFilter ? 'active' : ''}`;
            span.innerText = c === 'All' ? '全部' : c;
            span.onclick = () => { curFilter = c; renderFilter(); render(); };
            bar.appendChild(span);
        });
    }

    function render() {
        const list = document.getElementById('list');
        const empty = document.getElementById('empty');
        list.innerHTML = '';

        let viewData = data;
        if(curFilter !== 'All') viewData = data.filter(i => i.cat === curFilter);

        if(viewData.length === 0) {
            empty.style.display = 'block';
            return;
        }
        empty.style.display = 'none';

        viewData.forEach(item => {
            // 計算天數
            let statusHtml = '';
            if(item.status === 'new') {
                statusHtml = `<button class="btn-status st-new" onclick="toggleStatus(${item.id})">開瓶</button>`;
            } else {
                const d = Math.ceil(Math.abs(new Date() - new Date(item.openDate || item.date)) / 86400000);
                statusHtml = `<button class="btn-status st-used">${d}天</button>`;
            }

            const row = document.createElement('div');
            row.className = 'item-row';
            row.innerHTML = `
                <div class="info-col">
                    <div class="row-header">
                        <span class="i-name">${item.name}</span>
                        <span class="i-brand">${item.brand}</span>
                        <span class="i-cat">${item.cat}</span>
                    </div>
                    <div class="row-meta">
                        <span class="meta-tag"><b>Qty:</b>${item.qty}</span>
                        <span style="color:#eee">|</span>
                        <span class="meta-tag"><b>$</b>${item.price}</span>
                        <span style="color:#eee">|</span>
                        <span class="meta-tag">${item.date}</span>
                    </div>
                </div>
                <div class="action-col">
                    ${statusHtml}
                    <button class="btn-del" onclick="delItem(${item.id})">×</button>
                </div>
            `;
            list.appendChild(row);
        });
    }

    // --- Actions ---
    function openModal() {
        document.getElementById('modal').style.display = 'flex';
        document.getElementById('m_date').value = new Date().toISOString().split('T')[0];
        document.getElementById('m_brand').value = '';
        document.getElementById('m_name').value = '';
        document.getElementById('m_price').value = '';
        document.getElementById('m_status').value = 'new';
    }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    
    function checkCat(el) {
        if(el.value === 'ADD') {
            const n = prompt("New Category:");
            if(n) {
                const o = document.createElement('option');
                o.value = n; o.text = n; o.selected = true;
                el.add(o, el[0]);
            } else el.value = "精華液";
        }
    }

    function saveData() {
        const brand = document.getElementById('m_brand').value;
        const name = document.getElementById('m_name').value;
        const cat = document.getElementById('m_cat').value;
        const price = document.getElementById('m_price').value;
        const qty = document.getElementById('m_qty').value;
        const date = document.getElementById('m_date').value;
        const status = document.getElementById('m_status').value;

        if(!name) { alert("Name Required"); return; }

        data.unshift({
            id: Date.now(),
            brand, name, cat, price, qty, date, status,
            openDate: status === 'used' ? new Date().toISOString().split('T')[0] : null
        });
        localStorage.setItem(DB_KEY, JSON.stringify(data));
        closeModal();
        renderFilter();
        render();
    }

    function delItem(id) {
        if(confirm("Delete?")) {
            data = data.filter(i => i.id !== id);
            localStorage.setItem(DB_KEY, JSON.stringify(data));
            renderFilter();
            render();
        }
    }

    function toggleStatus(id) {
        if(confirm("Confirm Open?")) {
            const idx = data.findIndex(i => i.id === id);
            if(idx !== -1) {
                data[idx].status = 'used';
                data[idx].openDate = new Date().toISOString().split('T')[0];
                localStorage.setItem(DB_KEY, JSON.stringify(data));
                render();
            }
        }
    }

</script>
</body>
</html>
